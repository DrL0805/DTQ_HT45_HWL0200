

/* Includes -----------------------------------------------------*/
#include "lcd_lib.h"

LCD_PARAMETERS_T 		LCD;


const uint8_t Battery_3[64] = {
	0x00,0x00,0xF0,0xF0,0xF8,0x3C,0x0C,0xEC,0xEC,0xEC,0xEC,0xEC,0xEC,0x2C,0x8C,0xEC,
	0xEC,0xEC,0xEC,0x2C,0x8C,0xEC,0xEC,0xEC,0xEC,0xEC,0x0C,0xFC,0xFC,0x00,0x00,0x00,
	0x00,0x00,0x07,0x07,0x0F,0x1C,0x18,0x1B,0x1B,0x1B,0x1B,0x19,0x18,0x1A,0x1B,0x1B,
	0x1B,0x19,0x18,0x1A,0x1B,0x1B,0x1B,0x1B,0x1B,0x1B,0x18,0x1F,0x1F,0x00,0x00,0x00	
};
const uint8_t Battery_2[64] = {
	0x00,0x00,0xF0,0xF0,0xF8,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x8C,0xEC,
	0xEC,0xEC,0xEC,0x2C,0x8C,0xEC,0xEC,0xEC,0xEC,0xEC,0x0C,0xFC,0xFC,0x00,0x00,0x00,
	0x00,0x00,0x07,0x07,0x0F,0x1C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1A,0x1B,0x1B,
	0x1B,0x19,0x18,0x1A,0x1B,0x1B,0x1B,0x1B,0x1B,0x1B,0x18,0x1F,0x1F,0x00,0x00,0x00
};
const uint8_t Battery_1[64] = {
	0x00,0x00,0xF0,0xF0,0xF8,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,
	0x0C,0x0C,0x0C,0x0C,0x8C,0xEC,0xEC,0xEC,0xEC,0xEC,0x0C,0xFC,0xFC,0x00,0x00,0x00,
	0x00,0x00,0x07,0x07,0x0F,0x1C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
	0x18,0x18,0x18,0x1A,0x1B,0x1B,0x1B,0x1B,0x1B,0x1B,0x18,0x1F,0x1F,0x00,0x00,0x00
};
const uint8_t Battery_0[64] = {
	0x00,0x00,0xF0,0xF0,0xF8,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,
	0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0xFC,0xFC,0x00,0x00,0x00,
	0x00,0x00,0x07,0x07,0x0F,0x1C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
	0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1F,0x1F,0x00,0x00,0x00
};

const uint8_t Signal_4[64] = {
	0x00,0x00,0x06,0x0E,0x1A,0x32,0x62,0xFE,0xFE,0x62,0x32,0x1A,0x0E,0x06,0x00,0x00,
	0x80,0x80,0x80,0x00,0x00,0xE0,0xE0,0xE0,0x00,0x00,0xF8,0xF8,0xF8,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,0x00,0x00,0x1E,0x1E,0x1E,0x00,0x00,
	0x1F,0x1F,0x1F,0x00,0x00,0x1F,0x1F,0x1F,0x00,0x00,0x1F,0x1F,0x1F,0x00,0x00,0x00
};

const uint8_t Signal_3[64] = {
	0x00,0x00,0x06,0x0E,0x1A,0x32,0x62,0xFE,0xFE,0x62,0x32,0x1A,0x0E,0x06,0x00,0x00,
	0x80,0x80,0x80,0x00,0x00,0xE0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,0x00,0x00,0x1E,0x1E,0x1E,0x00,0x00,
	0x1F,0x1F,0x1F,0x00,0x00,0x1F,0x1F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

const uint8_t Signal_2[64] = {
	0x00,0x00,0x06,0x0E,0x1A,0x32,0x62,0xFE,0xFE,0x62,0x32,0x1A,0x0E,0x06,0x00,0x00,
	0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,0x00,0x00,0x1E,0x1E,0x1E,0x00,0x00,
	0x1F,0x1F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

const uint8_t Signal_1[64] = {
	0x00,0x00,0x06,0x0E,0x1A,0x32,0x62,0xFE,0xFE,0x62,0x32,0x1A,0x0E,0x06,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,0x00,0x00,0x1E,0x1E,0x1E,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

const uint8_t Signal_0[64] = {
	0x00,0x00,0x06,0x0E,0x1A,0x32,0x62,0xFE,0xFE,0x62,0x32,0x1A,0x0E,0x06,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* Functions ----------------------------------------------------*/


void LCD_Init(void)
{
	
	nrf_gpio_cfg_output(LCD_PIN_POWER);
	nrf_gpio_cfg_output(LCD_PIN_CSB);
	nrf_gpio_cfg_output(LCD_PIN_RST);
	nrf_gpio_cfg_output(LCD_PIN_A0);	
	nrf_gpio_cfg_output(LCD_PIN_SCL);
	nrf_gpio_cfg_output(LCD_PIN_SDA);		
	
}

//刷新LCD_RAM，更新LCD显示
void LCD_Update(void)
{
	uint8_t TmpLcdRam[18];		//临时保存LCDRAM信息
	
	if(LCD.UpdateFlg)
	{
		LCD.UpdateFlg = false;	
		
		switch(LCD.DisType)
		{
			case LCD_DIS_UPDATE:
				
				break;
			case LCD_DIS_VER:
				
				break;
			case LCD_DIS_RSSI:
				
				break;
			case LCD_DIS_VOLTAGE:
			
				break;
			case LCD_DIS_CHANNAL:
			
				break;
			case LCD_DIS_ATTEND:
				
				break;
			case LCD_DIS_DATE:
				
				break;
			default:
				LCD.DisType = LCD_DIS_UPDATE;
				break;
		}
	}
}

//关闭LCD显示，进入睡眠（低功耗）状态
void LCD_Sleep(void)
{
	LCD_DRV_WriteCmd(LCD_DISPLAY_OFF);	

}

//LCD唤醒，重新显示LCD_RAM内容
void LCD_WakeUp(void)
{
	LCD_DRV_WriteCmd(LCD_DISPLAY_ON);	
	

}


//全屏清屏
void LCD_ClearScreen(void)
{
	uint8_t TmpBuf[64];
	
	memset(TmpBuf, 0x00, 64);
	LCD_DRV_DisplayN(0, 64, TmpBuf);		
}

//全屏显示
void LCD_DisplayAll(void)
{
	uint8_t TmpBuf[64];
	
	memset(TmpBuf, 0xFF, 64);
	LCD_DRV_DisplayN(0, 64, TmpBuf);
}


void LCD_ClearLetter(void)
{

}

void LCD_DisplayLetter(uint8_t data)
{
	switch(data)
	{
		case LCD_A:
			
			break;
		case LCD_B:
			break;
		case LCD_C:
			break;
		case LCD_D:
			break;
		
	}
}

void LCD_DisplayJudge(uint8_t Value)
{
	
	LCD_ClearInputArea();
	
	switch(Value)
	{
		case JUDGE_CLEAR:
			
			break;
		case JUDGE_TRUE:
			LCD_DRV_DisplayOne(50, LCD_DRV_DOT_HANZI, 0xA1CC);
			break;
		case JUDGE_FALSE:
			LCD_DRV_DisplayOne(50, LCD_DRV_DOT_HANZI, 0xA1C1);
			break;
		default:
			break;
	}	
}

void LCD_DisplaySendResult(LCD_SEND_RESULT_TYPE SendResult)
{
	uint8_t TmpBuf[64];
	
	switch(SendResult)
	{
		case SEND_RESULT_CLEAR:
			memset(TmpBuf, 0x00, 64);
			LCD_DRV_DisplayN(56, 8, TmpBuf);			
			break;
		case SEND_RESULT_OK:
			LCD_DRV_DisplayOne(56, LCD_DRV_DOT_HANZI, 0xB7A2);
			LCD_DRV_DisplayOne(58, LCD_DRV_DOT_HANZI, 0xCBCD);
			LCD_DRV_DisplayOne(60, LCD_DRV_DOT_HANZI, 0xB3C9);
			LCD_DRV_DisplayOne(62, LCD_DRV_DOT_HANZI, 0xB9A6);
			break;
		case SEND_RESULT_FAIL:
			LCD_DRV_DisplayOne(56, LCD_DRV_DOT_HANZI, 0xB7A2);
			LCD_DRV_DisplayOne(58, LCD_DRV_DOT_HANZI, 0xCBCD);
			LCD_DRV_DisplayOne(60, LCD_DRV_DOT_HANZI, 0xCAA7);
			LCD_DRV_DisplayOne(62, LCD_DRV_DOT_HANZI, 0xB0DC);
			break;
		default:
			break;
	}	
}

void LCD_DisplaySignal(LCD_SIGNAL_LEVEL_TYPE Value)					//显示信号强度
{	
	uint8_t i,SignalDot[64];	
	
	switch(Value)
	{
		case RSSI_0:
			memcpy(SignalDot, Signal_0, 64);
			break;
		case RSSI_1:
			memcpy(SignalDot, Signal_1, 64);
			break;
		case RSSI_2:
			memcpy(SignalDot, Signal_2, 64);
			break;
		case RSSI_3:
			memcpy(SignalDot, Signal_3, 64);
			break;
		case RSSI_4:
			memcpy(SignalDot, Signal_4, 64);
			break;
		case RSSI_OFF:
			memset(SignalDot, 0x00, 64);
			break;		
		default:
			memset(SignalDot, 0x00, 64);
			break;
	}
	
	LCD_DRV_WriteCmd(0+0xb0);			// page
	LCD_DRV_WriteCmd(0x10 + 0);
	LCD_DRV_WriteCmd(0x00 + 0);
	for(i=0;i<32 ;i++)
	{
		LCD_DRV_WriteData(SignalDot[i]);
	}	
	
	LCD_DRV_WriteCmd(1+0xb0);			// page
	LCD_DRV_WriteCmd(0x10 + 0);
	LCD_DRV_WriteCmd(0x00 + 0);
	for(i=32;i<64 ;i++)
	{
		LCD_DRV_WriteData(SignalDot[i]);
	}	
}

void LCD_DisplayBattery(LCD_BATTERY_LEVEL_TYPE Value)			//显示电池电量
{
	uint8_t i,BatteryDot[64];
	
	switch(Value)
	{
		case BATTERY_LEVEL_0:
			memcpy(BatteryDot, Battery_0, 64);
			break;
		case BATTERY_LEVEL_1:
			memcpy(BatteryDot, Battery_1, 64);
			break;
		case BATTERY_LEVEL_2:
			memcpy(BatteryDot, Battery_2, 64);
			break;
		case BATTERY_LEVEL_3:
			memcpy(BatteryDot, Battery_3, 64);
			break;
		default:
			memset(BatteryDot, 0x00, 64);
			break;
	}	

	LCD_DRV_WriteCmd(0+0xb0);			// page
	LCD_DRV_WriteCmd(0x10 + 6);
	LCD_DRV_WriteCmd(0x00 + 0);
	for(i=0;i<32 ;i++)
	{
		LCD_DRV_WriteData(BatteryDot[i]);
	}	
	
	LCD_DRV_WriteCmd(1+0xb0);			// page
	LCD_DRV_WriteCmd(0x10 + 6);
	LCD_DRV_WriteCmd(0x00 + 0);
	for(i=32;i<64 ;i++)
	{
		LCD_DRV_WriteData(BatteryDot[i]);
	}	
	
}

void LCD_ClearSegment(void)
{

}


void LCD_DisplayStudentName(void)
{
	uint8_t i, TmpNameLen = 0;

	LCD_ClearNameArea();
	
	// 计算名字长度
	for(i = 0;i < 12;i++)
	{
		// 中文GBK码不可能有0x00
		if(0x00 == RADIO.MATCH.Student.Name[i])	
		{
			TmpNameLen = i / 2;
			break;
		}
	}
	
	if(TmpNameLen)
	{
		for(i = 0;i < TmpNameLen;i++)
		{
//			LCD_DRV_DisplayHanzi(1,1+i,(RADIO.MATCH.Student.Name[2*i] << 8) | RADIO.MATCH.Student.Name[2*i+1]);	
			LCD_DRV_DisplayOne(18+i*2, LCD_DRV_DOT_HANZI, (uint16_t)((RADIO.MATCH.Student.Name[2*i] << 8) | RADIO.MATCH.Student.Name[2*i+1]));
		}	
	}
	else
	{
		LCD_DRV_DisplayOne(18, LCD_DRV_DOT_HANZI, 0xCEDE);// 无
		LCD_DRV_DisplayOne(20, LCD_DRV_DOT_HANZI, 0xD0D5);// 姓
		LCD_DRV_DisplayOne(22, LCD_DRV_DOT_HANZI, 0xC3FB);// 名
	}
}

void LCD_DisplayQuestionNum(uint16_t question_num)
{

}

void LCD_DisplayScoreValue(uint16_t grade_value)
{
	uint8_t Tmp;
	
	LCD_ClearScoreArea();	
	
	Tmp = grade_value % 10;
	LCD_DRV_DisplayDigit(1, 14, Tmp);		// 个位
	Tmp = (grade_value % 100) / 10;			
	LCD_DRV_DisplayDigit(1, 13, Tmp);		// 十位
	Tmp = (grade_value % 1000) / 100;				
	LCD_DRV_DisplayDigit(1, 12, Tmp);		// 百位
	
}


void LCD_DisplayDeviceId(void)
{
	uint32_t TmpUid, i;
	
	TmpUid =  RADIO.MATCH.DtqUid[0] 	   | 
			   RADIO.MATCH.DtqUid[1] << 8  |
			   RADIO.MATCH.DtqUid[2] << 16 |
			   RADIO.MATCH.DtqUid[3] << 24 ;

	for(i = 0;i < 6;i++)
	{
		LCD_DRV_DisplayDigit(0, 10-i, TmpUid%10);
		TmpUid = TmpUid/10;
	}
}


void LCD_ClearInputArea(void)
{
	uint8_t TmpBuf[64];
	
	memset(TmpBuf, 0x00, 64);
	LCD_DRV_DisplayN(48, 16, TmpBuf);	
}

void LCD_ClearSceneArea(void)
{
	uint8_t TmpBuf[64];
	
	memset(TmpBuf, 0x00, 64);
	LCD_DRV_DisplayN(32, 16, TmpBuf);		
}
void LCD_ClearNameArea(void)
{
	uint8_t TmpBuf[64];
	
	memset(TmpBuf, 0x00, 64);
	LCD_DRV_DisplayN(16, 12, TmpBuf);	
}

void LCD_ClearScoreArea(void)
{
	uint8_t TmpBuf[64];
	
	memset(TmpBuf, 0x00, 64);
	LCD_DRV_DisplayN(28, 6, TmpBuf);	
}


#define DISPLAY_TIME 		(200)						//显示的时间
void LCD_DisplayTest(void)
{
}








